@{
    ViewData["Title"] = "Set New Password";
    Layout = "~/Areas/Customer/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="~/Customer/css/set-new-password.css" />

<section class="set-password-section">
    <div class="password-card">
        <div class="password-icon">
            <i class="fa fa-key"></i>
        </div>

        <h2>Set Your New Password</h2>
        <p class="subtitle">
            Welcome, <span class="customer-name">@ViewData["CustomerName"]</span>!<br>
            Please create a new password to secure your account.
        </p>

        @if (TempData["Info"] != null)
        {
            <div class="alert-info">
                <i class="fa fa-info-circle"></i>
                <span>@TempData["Info"]</span>
            </div>
        }

        @if (ViewData["Error"] != null)
        {
            <div class="alert-error">
                <i class="fa fa-exclamation-circle"></i>
                <span>@ViewData["Error"]</span>
            </div>
        }

        <form method="post" asp-action="SetNewPassword">
            <div class="form-group">
                <label for="newPassword">New Password</label>
                <div class="input-wrapper">
                    <input type="password"
                           name="newPassword"
                           id="newPassword"
                           required
                           minlength="8"
                           placeholder="Enter new password (min 8 characters)">
                    <button type="button" class="toggle-password" onclick="togglePassword('newPassword', this)">
                        <i class="fa fa-eye"></i>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="confirmPassword">Confirm Password</label>
                <div class="input-wrapper">
                    <input type="password"
                           name="confirmPassword"
                           id="confirmPassword"
                           required
                           minlength="8"
                           placeholder="Confirm your new password">
                    <button type="button" class="toggle-password" onclick="togglePassword('confirmPassword', this)">
                        <i class="fa fa-eye"></i>
                    </button>
                </div>
            </div>

            <div class="requirements-box">
                <h4>Password Requirements:</h4>
                <ul>
                    <li id="req-length">
                        <span class="icon">○</span> At least 8 characters
                    </li>
                    <li id="req-match">
                        <span class="icon">○</span> Passwords must match
                    </li>
                </ul>
            </div>

            <button type="submit" id="submitBtn" class="btn-submit" disabled>
                <i class="fa fa-lock"></i> Set New Password
            </button>
        </form>
    </div>
</section>

@section Scripts {
    <script>
        function togglePassword(inputId, button) {
            const input = document.getElementById(inputId);
            const icon = button.querySelector('i');

            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const newPassword = document.getElementById('newPassword');
            const confirmPassword = document.getElementById('confirmPassword');
            const submitBtn = document.getElementById('submitBtn');
            const reqLength = document.getElementById('req-length');
            const reqMatch = document.getElementById('req-match');

            function validatePasswords() {
                const pwd = newPassword.value;
                const confirm = confirmPassword.value;

                // Check length
                const lengthValid = pwd.length >= 8;
                if (lengthValid) {
                    reqLength.innerHTML = '<span class="icon">✓</span> At least 8 characters';
                    reqLength.classList.add('valid');
                } else {
                    reqLength.innerHTML = '<span class="icon">○</span> At least 8 characters';
                    reqLength.classList.remove('valid');
                }

                // Check match
                const matchValid = pwd === confirm && confirm.length > 0;
                if (matchValid) {
                    reqMatch.innerHTML = '<span class="icon">✓</span> Passwords must match';
                    reqMatch.classList.add('valid');
                } else {
                    reqMatch.innerHTML = '<span class="icon">○</span> Passwords must match';
                    reqMatch.classList.remove('valid');
                }

                // Enable/disable submit button
                submitBtn.disabled = !(lengthValid && matchValid);
            }

            newPassword.addEventListener('input', validatePasswords);
            confirmPassword.addEventListener('input', validatePasswords);
        });
    </script>
}

