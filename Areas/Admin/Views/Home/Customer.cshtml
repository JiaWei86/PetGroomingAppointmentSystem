@{
    ViewData["Title"] = "Customer Management";
    ViewData["ActivePage"] = "Customer";
}

<div class="content-header">
    <h1 class="page-title">Customer Management</h1>
</div>

<!-- Filters Section -->
<div class="panel">
    <h3 class="panel-title">Filter Customers</h3>
    
    <form method="get" class="form-grid filter-form">
        <div class="form-group">
            <label for="searchName">Search Name</label>
            <input type="text" id="searchName" name="searchName" class="form-control" placeholder="First or Last Name" />
        </div>

        <div class="form-group">
            <label for="searchEmail">Email</label>
            <input type="email" id="searchEmail" name="searchEmail" class="form-control" placeholder="Email address" />
        </div>

        <div class="form-group">
            <label for="searchCity">City</label>
            <input type="text" id="searchCity" name="searchCity" class="form-control" placeholder="City" />
        </div>

        <div class="form-group">
            <label>&nbsp;</label>
            <button type="submit" class="btn btn-primary">Filter</button>
            <button type="reset" class="btn btn-reset">Reset</button>
        </div>
    </form>
</div>

<!-- Customers Table -->
<div class="panel">
    @{
        // Hard-coded sample data
        var customers = new List<dynamic>
        {
            new { 
                Id = 1, 
                FirstName = "John", 
                LastName = "Doe", 
                Email = "john@example.com", 
                PhoneNumber = "555-1234", 
                Address = "123 Main St", 
                City = "New York", 
                PostalCode = "10001", 
                CreatedAt = DateTime.Parse("Jan 15, 2024"), 
                Pets = new List<dynamic> { new { Id = 1, Name = "Buddy", Type = "Dog" }, new { Id = 3, Name = "Max", Type = "Dog" } },
                LoyaltyPoints = new List<dynamic> { new { PointsBalance = 250 } }
            },
            new { 
                Id = 2, 
                FirstName = "Sarah", 
                LastName = "Johnson", 
                Email = "sarah@example.com", 
                PhoneNumber = "555-5678", 
                Address = "456 Oak Ave", 
                City = "Los Angeles", 
                PostalCode = "90001", 
                CreatedAt = DateTime.Parse("Feb 10, 2024"), 
                Pets = new List<dynamic> { new { Id = 2, Name = "Whiskers", Type = "Cat" } },
                LoyaltyPoints = new List<dynamic> { new { PointsBalance = 150 } }
            },
            new { 
                Id = 3, 
                FirstName = "Michael", 
                LastName = "Smith", 
                Email = "michael@example.com", 
                PhoneNumber = "555-9012", 
                Address = "789 Pine Rd", 
                City = "Chicago", 
                PostalCode = "60601", 
                CreatedAt = DateTime.Parse("Mar 05, 2024"), 
                Pets = new List<dynamic>(),
                LoyaltyPoints = new List<dynamic> { new { PointsBalance = 500 } }
            },
            new { 
                Id = 4, 
                FirstName = "Emily", 
                LastName = "Davis", 
                Email = "emily@example.com", 
                PhoneNumber = "555-3456", 
                Address = "321 Elm St", 
                City = "Houston", 
                PostalCode = "77001", 
                CreatedAt = DateTime.Parse("Apr 12, 2024"), 
                Pets = new List<dynamic> { new { Id = 4, Name = "Rex", Type = "Dog" } },
                LoyaltyPoints = new List<dynamic> { new { PointsBalance = 300 } }
            }
        };
    }

    <div class="panel-header-wrapper">
        <h3 class="panel-title">Customers (@customers.Count)</h3>
        <button class="btn btn-primary" onclick="showCreateForm()">+ New Customer</button>
    </div>

    @if (customers.Count > 0)
    {
        <div class="table-responsive">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>City</th>
                        <th>Postal Code</th>
                        <th>Pets</th>
                        <th>Loyalty Points</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var customer in customers)
                    {
                        <tr>
                            <td><strong>@customer.FirstName @customer.LastName</strong></td>
                            <td>@customer.Email</td>
                            <td>@customer.PhoneNumber</td>
                            <td>@customer.City</td>
                            <td>@customer.PostalCode</td>
                            <td><span class="badge">@((customer.Pets as List<dynamic>).Count)</span></td>
                            <td>
                                @{
                                    var loyaltyPoints = (customer.LoyaltyPoints as List<dynamic>).FirstOrDefault();
                                    if (loyaltyPoints != null)
                                    {
                                        <span class="points-badge">@loyaltyPoints.PointsBalance</span>
                                    }
                                    else
                                    {
                                        <span class="points-badge">0</span>
                                    }
                                }
                            </td>
                            <td>@customer.CreatedAt.ToString("MMM dd, yyyy")</td>
                            <td>
                                <button class="btn btn-sm btn-info" onclick="showCustomerDetails(@customer.Id)">View</button>
                                <button class="btn btn-sm btn-action edit-btn" onclick="editCustomer(@customer.Id)">Edit</button>
                                <button class="btn btn-sm btn-action delete-btn" onclick="deleteCustomer(@customer.Id)">Delete</button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <div class="empty-state">
            <p>No customers found.</p>
        </div>
    }
</div>

<!-- View Customer Details Modal (Read-only) -->
<div id="customerViewModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="viewTitle">Customer Details</h2>
            <button class="close-btn" onclick="closeViewModal()">&times;</button>
        </div>

        <div class="modal-body">
            <div class="details-grid">
                <div class="detail-row">
                    <span class="detail-label">Name:</span>
                    <span class="detail-value" id="viewName"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Email:</span>
                    <span class="detail-value" id="viewEmail"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Phone:</span>
                    <span class="detail-value" id="viewPhone"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Address:</span>
                    <span class="detail-value" id="viewAddress"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">City:</span>
                    <span class="detail-value" id="viewCity"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Postal Code:</span>
                    <span class="detail-value" id="viewPostalCode"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Created:</span>
                    <span class="detail-value" id="viewCreatedAt"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Updated:</span>
                    <span class="detail-value" id="viewUpdatedAt"></span>
                </div>
            </div>

            <!-- Tabs for Pets and Loyalty Points -->
            <div class="customer-details-tabs">
                <div class="tabs-nav">
                    <button class="tab-btn active" onclick="switchTab('pets-tab')">Pets</button>
                    <button class="tab-btn" onclick="switchTab('loyalty-tab')">Loyalty Points</button>
                </div>

                <!-- Pets Tab -->
                <div id="pets-tab" class="tab-content active">
                    <div id="petsList" class="pets-list-container">
                        <p class="empty-message">No pets assigned</p>
                    </div>
                </div>

                <!-- Loyalty Points Tab -->
                <div id="loyalty-tab" class="tab-content">
                    <div class="loyalty-summary">
                        <div class="loyalty-card">
                            <div class="loyalty-label">Total Points</div>
                            <div class="loyalty-value" id="loyaltyPointsValue">0</div>
                        </div>
                        <div class="loyalty-card">
                            <div class="loyalty-label">Last Updated</div>
                            <div class="loyalty-value" id="loyaltyLastUpdated">N/A</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeViewModal()">Close</button>
        </div>
    </div>
</div>

<!-- Create/Edit Customer Form -->
<div class="panel create-form" id="createCustomerForm">
    <h3 class="panel-title">Create New Customer</h3>

    <form asp-controller="Home" asp-action="CreateCustomer" method="post" class="form-grid">
        <div class="form-group">
            <label for="firstName">First Name</label>
            <input type="text" id="firstName" name="FirstName" required />
        </div>

        <div class="form-group">
            <label for="lastName">Last Name</label>
            <input type="text" id="lastName" name="LastName" required />
        </div>

        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="Email" required />
        </div>

        <div class="form-group">
            <label for="phone">Phone Number</label>
            <input type="tel" id="phone" name="PhoneNumber" required />
        </div>

        <div class="form-group">
            <label for="address">Address</label>
            <input type="text" id="address" name="Address" required />
        </div>

        <div class="form-group">
            <label for="city">City</label>
            <input type="text" id="city" name="City" required />
        </div>

        <div class="form-group">
            <label for="postalCode">Postal Code</label>
            <input type="text" id="postalCode" name="PostalCode" required />
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-reset" onclick="hideCreateForm()">Cancel</button>
            <button type="submit" class="btn btn-success">Save Customer</button>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        function showCreateForm() {
            document.getElementById('createCustomerForm').classList.add('visible');
            document.querySelector('html').style.overflow = 'hidden';
        }

        function hideCreateForm() {
            document.getElementById('createCustomerForm').classList.remove('visible');
            document.querySelector('html').style.overflow = 'auto';
        }

        function editCustomer(id) {
            alert('Edit functionality for customer #' + id + ' would go here');
            showCreateForm();
        }

        function deleteCustomer(id) {
            if (confirm('Are you sure you want to delete this customer?')) {
                alert('Customer #' + id + ' deleted successfully');
                location.reload();
            }
        }

        document.addEventListener('click', function(event) {
            const form = document.getElementById('createCustomerForm');
            if (event.target === form) {
                hideCreateForm();
            }
        });
    </script>
}