@{
    ViewData["Title"] = "Administrator Dashboard";
    ViewData["ActivePage"] = "Dashboard";
    var appointments = ViewBag.Appointments as List<PetGroomingAppointmentSystem.Areas.Admin.Models.Appointment> ?? new List<PetGroomingAppointmentSystem.Areas.Admin.Models.Appointment>();
    var groomers = ViewBag.Groomers as List<PetGroomingAppointmentSystem.Areas.Admin.Models.Groomer> ?? new List<PetGroomingAppointmentSystem.Areas.Admin.Models.Groomer>();
    var currentMonth = ViewBag.CurrentMonth as DateTime? ?? DateTime.Now;
}

<div class="content-header">
    <h1 class="page-title">Dashboard</h1>
</div>

<div class="stats-grid">
    <div class="stat-card blue">
        <p class="stat-title">Total Appointments</p>
        <div class="stat-value">@appointments.Count <span class="change up">↑ 12%</span></div>
        <p class="stat-extra">This month's appointments</p>
    </div>

    <div class="stat-card green">
        <p class="stat-title">Active Groomers</p>
        <div class="stat-value">@groomers.Count(g => g.Status == "Active") <span class="change up">↑ 2</span></div>
        <p class="stat-extra">Available to work</p>
    </div>

    <div class="stat-card yellow">
        <p class="stat-title">Pending Appointments</p>
        <div class="stat-value">@appointments.Count(a => a.Status == "Pending") <span class="change up">↑ 1</span></div>
        <p class="stat-extra">Awaiting confirmation</p>
    </div>

    <div class="stat-card red">
        <p class="stat-title">Total Revenue</p>
        <div class="stat-value">$35,078 <span class="change down">↓ 27.4%</span></div>
        <p class="stat-extra">You made an extra **$203,395** this year</p>
    </div>
</div>

<div class="chart-and-info-grid">
    <div class="chart-panel">
        <h3 class="panel-title">Appointment Trend</h3>
        <div class="chart-options">
            <button class="btn-chart-option">Month</button>
            <button class="btn-chart-option active">Week</button>
        </div>
        <div class="placeholder-chart">
            <p>Graph showing appointment volume over time...</p>
        </div>
    </div>

    <div class="info-panel">
        <h3 class="panel-title">Loyalty Points Overview</h3>
        <p class="stat-value-large">7,650</p>
        <p class="panel-subtitle">Total Points Awarded This Week</p>
        <div class="placeholder-bar-chart">
            <p>Bar chart showing customer loyalty tiers...</p>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Sample appointment data
        const appointmentData = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(appointments.Select(a => new {
            id = a.Id,
            date = a.AppointmentDate.ToString("yyyy-MM-dd"),
            time = a.StartTime.ToString(@"hh\:mm"),
            petName = a.PetName,
            groomerName = groomers.FirstOrDefault(g => g.Id == a.GroomerId)?.FirstName + " " + groomers.FirstOrDefault(g => g.Id == a.GroomerId)?.LastName,
            serviceType = a.ServiceType,
            status = a.Status
        })));

        let currentDate = new Date();

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            // Update header
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            document.getElementById('monthYear').textContent = monthNames[month] + ' ' + year;

            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            let calendarHTML = '<div class="day-names">';
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayNames.forEach(day => {
                calendarHTML += `<div class="day-name">${day}</div>`;
            });
            calendarHTML += '</div>';

            calendarHTML += '<div class="calendar-dates">';

            // Empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                calendarHTML += '<div class="empty-day"></div>';
            }

            // Days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayAppointments = appointmentData.filter(a => a.date === dateStr);
                const hasAppointments = dayAppointments.length > 0;

                calendarHTML += `
                    <div class="calendar-day ${hasAppointments ? 'has-appointments' : ''}" data-date="${dateStr}">
                        <div class="day-number">${day}</div>
                        <div class="appointments-count">${hasAppointments ? `${dayAppointments.length} app.` : ''}</div>
                    </div>
                `;
            }

            calendarHTML += '</div>';
            document.getElementById('calendar').innerHTML = calendarHTML;

            // Add click handlers
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.addEventListener('click', function() {
                    const date = this.getAttribute('data-date');
                    showAppointmentsForDate(date);
                    document.querySelectorAll('.calendar-day').forEach(d => d.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });

            // Show today's appointments by default
            const today = new Date();
            const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            showAppointmentsForDate(todayStr);
        }

        function showAppointmentsForDate(dateStr) {
            const dayAppointments = appointmentData.filter(a => a.date === dateStr);
            const appointmentsList = document.getElementById('appointmentsList');

            if (dayAppointments.length === 0) {
                appointmentsList.innerHTML = `<p class="no-appointments">No appointments on ${dateStr}</p>`;
                return;
            }

            let html = '<div class="appointments-group">';
            dayAppointments.forEach(appointment => {
                html += `
                    <div class="appointment-item ${appointment.status.toLowerCase()}">
                        <div class="appointment-time">${appointment.time}</div>
                        <div class="appointment-details">
                            <div class="appointment-pet">${appointment.petName}</div>
                            <div class="appointment-groomer">👤 ${appointment.groomerName}</div>
                            <div class="appointment-service">${appointment.serviceType}</div>
                        </div>
                        <div class="appointment-status">${appointment.status}</div>
                    </div>
                `;
            });
            html += '</div>';
            appointmentsList.innerHTML = html;
        }

        // Navigation
        document.getElementById('prevMonth').addEventListener('click', function() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', function() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });

        // Initial render
        renderCalendar();
    </script>
}