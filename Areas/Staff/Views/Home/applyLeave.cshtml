@{
    ViewData["Title"] = "Apply Leave";
    ViewData["ActivePage"] = "ApplyLeave";
}

<div class="panel">
    <div class="panel-header-wrapper">
        <h3 class="panel-title">Apply for Leave</h3>
    </div>

    <div class="leave-application-container">
        <!-- Leave Summary Cards -->
        <div class="leave-summary-cards">
            <div class="summary-card">
                <div class="card-icon">
                    <i class="material-icons">calendar_today</i>
                </div>
                <div class="card-content">
                    <div class="card-label">Available Leave Days</div>
                    <div class="card-value">12</div>
                </div>
            </div>

            <div class="summary-card">
                <div class="card-icon">
                    <i class="material-icons">check_circle</i>
                </div>
                <div class="card-content">
                    <div class="card-label">Used Leave Days</div>
                    <div class="card-value">3</div>
                </div>
            </div>

            <div class="summary-card">
                <div class="card-icon">
                    <i class="material-icons">pending_actions</i>
                </div>
                <div class="card-content">
                    <div class="card-label">Pending Requests</div>
                    <div class="card-value">1</div>
                </div>
            </div>
        </div>

        <!-- Leave Application Form -->
        <form id="leaveApplicationForm" class="leave-form">
            <div class="form-section">
                <h4 class="section-title">Leave Details</h4>

                <!-- Leave Type Selection -->
                <div class="form-group">
                    <label for="leaveType" class="form-label">Leave Type <span class="required">*</span></label>
                    <select id="leaveType" name="leaveType" class="form-control" required>
                        <option value="">-- Select Leave Type --</option>
                        <option value="annual">Annual Leave</option>
                        <option value="sick">Sick Leave</option>
                        <option value="casual">Casual Leave</option>
                        <option value="emergency">Emergency Leave</option>
                        <option value="unpaid">Unpaid Leave</option>
                    </select>
                </div>

                <!-- Start Date -->
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="startDate" class="form-label">Start Date <span class="required">*</span></label>
                        <input type="date" id="startDate" name="startDate" class="form-control" required>
                    </div>

                    <!-- End Date -->
                    <div class="form-group col-md-6">
                        <label for="endDate" class="form-label">End Date <span class="required">*</span></label>
                        <input type="date" id="endDate" name="endDate" class="form-control" required>
                    </div>
                </div>

                <!-- Duration -->
                <div class="form-group">
                    <label for="duration" class="form-label">Duration</label>
                    <div class="duration-display">
                        <span id="durationDays" class="duration-value">0</span>
                        <span class="duration-label">day(s)</span>
                    </div>
                </div>

                <!-- Reason / Description -->
                <div class="form-group">
                    <label for="reason" class="form-label">Reason for Leave <span class="required">*</span></label>
                    <textarea id="reason"
                              name="reason"
                              class="form-control textarea-control"
                              rows="4"
                              placeholder="Please provide a brief reason for your leave request..."
                              required></textarea>
                    <small class="form-text">Maximum 500 characters</small>
                </div>

                <!-- Additional Documents -->
                <div class="form-section">
                    <h4 class="section-title">Supporting Documents</h4>
                    <p class="section-hint">Upload supporting documents if applicable (e.g., medical certificate for sick leave)</p>

                    <div class="form-group">
                        <label for="documents" class="form-label">Attach Files</label>
                        <div class="file-upload-area">
                            <input type="file" id="documents" name="documents" class="file-input" multiple accept=".pdf,.jpg,.jpeg,.png,.doc,.docx">
                            <div class="upload-placeholder">
                                <i class="material-icons">cloud_upload</i>
                                <p>Click to upload or drag and drop</p>
                                <small>Supported formats: PDF, JPG, PNG, DOC, DOCX (Max 5MB each)</small>
                            </div>
                        </div>
                        <div id="fileList" class="file-list"></div>
                    </div>
                </div>

                <!-- Agreement Checkbox -->
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="agreement" name="agreement" required>
                        <span>I confirm that all information provided is accurate and complete</span>
                    </label>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="material-icons">send</i>
                    Submit Leave Request
                </button>
                <button type="reset" class="btn btn-secondary">
                    <i class="material-icons">refresh</i>
                    Clear Form
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Leave History Section -->
<div class="panel mt-4">
    <div class="panel-header-wrapper">
        <h3 class="panel-title">Leave History</h3>
    </div>

    <div class="table-responsive">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Leave Type</th>
                    <th>From Date</th>
                    <th>To Date</th>
                    <th>Duration</th>
                    <th>Status</th>
                    <th>Applied On</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="leave-badge annual">Annual Leave</span></td>
                    <td>Jan 15, 2024</td>
                    <td>Jan 17, 2024</td>
                    <td>3 days</td>
                    <td><span class="status-badge approved">Approved</span></td>
                    <td>Jan 10, 2024</td>
                </tr>
                <tr>
                    <td><span class="leave-badge pending">Emergency Leave</span></td>
                    <td>Dec 25, 2024</td>
                    <td>Dec 25, 2024</td>
                    <td>1 day</td>
                    <td><span class="status-badge pending">Pending</span></td>
                    <td>Dec 20, 2024</td>
                </tr>
                <tr>
                    <td><span class="leave-badge sick">Sick Leave</span></td>
                    <td>Dec 10, 2024</td>
                    <td>Dec 11, 2024</td>
                    <td>2 days</td>
                    <td><span class="status-badge approved">Approved</span></td>
                    <td>Dec 08, 2024</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
@section Scripts {
    <script>
        // Calculate duration when dates change
        document.getElementById('startDate').addEventListener('change', calculateDuration);
        document.getElementById('endDate').addEventListener('change', calculateDuration);

        function calculateDuration() {
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);

            if (startDate && endDate && endDate >= startDate) {
                const duration = Math.floor((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
                document.getElementById('durationDays').textContent = duration;
            }
        }

        // File upload handling
        document.getElementById('documents').addEventListener('change', function(e) {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';

            Array.from(this.files).forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <span>${file.name} (${(file.size / 1024).toFixed(2)} KB)</span>
                    <button type="button" onclick="this.parentElement.remove()" style="background: none; border: none; color: #e74c3c; cursor: pointer;">
                        <i class="material-icons" style="font-size: 18px;">close</i>
                    </button>
                `;
                fileList.appendChild(fileItem);
            });
        });

        // Form submission
        document.getElementById('leaveApplicationForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // Validate form
            if (!this.checkValidity()) {
                alert('Please fill in all required fields');
                return;
            }

            // Success message
            alert('Leave request submitted successfully! You will receive an email notification once it is reviewed.');

            // Reset form
            this.reset();
            document.getElementById('fileList').innerHTML = '';
        });
    </script>
}